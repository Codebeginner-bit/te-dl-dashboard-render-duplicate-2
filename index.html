<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TE Dashboard</title>
    <style>
        :root { --background: 255 255 255; --foreground: 0 0 0; --muted: 241 245 249; --muted-foreground: 100 116 139; --border: 226 232 240; --primary: #007bff; }
        .hidden { display: none !important; }
        body { font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif; background-color: rgb(var(--background)); color: rgb(var(--foreground)); line-height: 1.5; margin: 0; padding: 0; }
        .login-container { display: flex; align-items: center; justify-content: center; min-height: 100vh; background-color: rgb(var(--muted)); padding: 1rem; box-sizing: border-box;}
        .login-form { background-color: #fff; padding: 2rem; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); width: 100%; max-width: 400px; }
        .login-form h1 { text-align: center; color: rgb(var(--foreground)); margin-bottom: 1.5rem; font-size: 1.8rem; }
        .input-group { margin-bottom: 1rem; }
        .input-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; font-size: 0.9rem; color: rgb(var(--muted-foreground)); }
        .input-group input { width: 100%; padding: 10px; border: 1px solid rgb(var(--border)); border-radius: 4px; box-sizing: border-box; font-size: 1rem; }
        .input-group button { width: 100%; padding: 12px; background-color: var(--primary); border: none; border-radius: 4px; color: white; font-size: 1.1rem; cursor: pointer; margin-top: 1rem;}
        .input-group button:hover { background-color: #0056b3; }
        #login-error { color: red; text-align: center; margin-top: 0.5rem; }
    </style>
</head>
<body>
    <div id="login-section" class="login-container">
        <form id="login-form" class="login-form">
            <h1>Login</h1>
            <div id="login-error" class="hidden"></div>
            <div class="input-group">
                <label for="username">Username</label>
                <input type="text" id="username" required>
            </div>
            <div class="input-group">
                <label for="password">Password</label>
                <input type="password" id="password" required>
            </div>
            <div class="input-group">
                <button type="submit">Login</button>
            </div>
        </form>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const loginForm = document.getElementById('login-form');
            const loginError = document.getElementById('login-error');
            if (localStorage.getItem('authToken')) {
                window.location.href = '/dashboard.html';
                return;
            }

            loginForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                loginError.classList.add('hidden'); 
                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                try {
                    const response = await fetch('/api/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ username, password }),
                    });

                    const result = await response.json();

                    if (!response.ok) {
                        loginError.textContent = result.error || 'An unknown error occurred.';
                        loginError.classList.remove('hidden');
                    } else {
                        localStorage.setItem('authToken', result.token);
                        window.location.href = '/dashboard.html';
                    }
                } catch (error) {
                    console.error('Login request failed:', error);
                    loginError.textContent = 'Could not connect to the server. Please try again later.';
                    loginError.classList.remove('hidden');
                }
            });
        });
    </script>
</body>
</html>

